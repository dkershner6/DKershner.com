<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link href="/favicon.ico" rel="shortcut icon"><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport"><meta content="#000000" name="theme-color"><link href="/manifest.json" rel="manifest"><title>Azure Functions: When to use App Service Plan | DKershner.com</title><link href="/static/css/main.90fa2f6c.chunk.css" rel="stylesheet"><link href="https://fonts.googleapis.com" rel="preconnect"><style data-styled="" data-styled-version="4.3.2"></style><link href="https://www.google-analytics.com" rel="preconnect"><link href="https://fonts.gstatic.com" rel="preconnect"><link href="/static/js/2.9796f5c4.chunk.js" rel="preload" as="script"><link href="/static/js/main.617d17a6.chunk.js" rel="preload" as="script"><link href="https://www.google-analytics.com" rel="preconnect"><link href="https://fonts.googleapis.com" rel="preconnect"><style data-styled="" data-styled-version="4.3.2"></style><link href="https://fonts.gstatic.com" rel="preconnect"><link href="/static/js/2.9796f5c4.chunk.js" rel="preload" as="script"><link href="/static/js/main.617d17a6.chunk.js" rel="preload" as="script"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><nav class="navbar navbar-expand-lg navbar-dark bg-dark"><a href="/" class="active navbar-brand">Derek Kershner</a><button aria-controls="responsive-navbar-nav" aria-label="Toggle navigation" class="navbar-toggler" id="navbar-toggle" type="button"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="navbar-collapse"><div class="mr-auto navbar-nav"><a href="/" class="nav-link" data-rb-event-key="/">Home</a><a href="/#about" class="nav-link" data-rb-event-key="/#about">About</a><div class="dropdown nav-item" href="/portfolio"><a href="#" class="dropdown-toggle nav-link" aria-expanded="false" aria-haspopup="true" role="button">Portfolio</a><div class="dropdown-menu" aria-labelledby=""><a href="/portfolio/codeChallenges" class="dropdown-item">Code Challenges</a><div class="dropdown-divider" role="separator"></div><a href="/portfolio/enterpriseMarketplace" class="dropdown-item">Enterprise Marketplace</a><a href="/portfolio/shopifySearchEngine" class="dropdown-item">Shopify Search Engine</a></div></div><a href="/blog" class="nav-link" data-rb-event-key="/blog">Blog</a></div></div></nav><div class="bg-primary text-light jumbotron jumbotron-fluid"><div class="container"><h1>Azure Functions: When to use App Service Plan</h1><h5>When does the transition make the most sense (for Azure functions v1)</h5><h6>2018-08-24 by Derek Kershner</h6></div></div><div class="mt-5 container"><div class="row"><div class="col"><h3>Update: 2/26/19</h3><p>I have moved all of my functions to Azure Functions v2 (.Net Core) and have a <a href="/blog/azure-functions-consumption-vs-app-service-vs-kubernetes">new comparison</a> for those functions.</p><hr><h3>Common Question</h3><p>When to move on from the consumption plan is actually a tougher question to answer than I thought it would be. There are almost no analyses online, and the <a href="https://www.azurefromthetrenches.com/azure-functions-scaling-with-a-dedicated-app-service-plan/">one that I found</a> had inaccurate information.</p><h3>Common Misconception</h3><p>In <a href="https://www.azurefromthetrenches.com/azure-functions-scaling-with-a-dedicated-app-service-plan/">that article</a>, James does a good job of comparing the performance (and <a href="https://www.azurefromthetrenches.com/azure-functions-significant-improvements-in-http-trigger-scaling/">updates the performance later on</a> as well), but falls flat on his cost conclusions. The reason for this is people tend to focus on execution cost only.</p><p><img alt="Cost Assumptions" src="/posts/images/costassumptions.jpg"></p><p>Now, this all appears fine until some simple math: $130 / 640 = ~$0.20/million - that $0.20 number looks an awful lot like one of <a href="https://azure.microsoft.com/en-us/pricing/details/functions/">Microsoft's consumption costs</a>.</p><p><img alt="Functions Cost" src="/posts/images/functionscost.jpg"></p><p>But, as you see in red, it totally ignores the other costs associated with functions, that can often be as high as <strong>85% of the cost</strong> or higher.</p><h3>Fixing Assumptions</h3><p>Since his function was very simple, we can safely assume it would use the minimum memory per function of 128MB. Given an average runtime of 0.581s per run, we can multiply these all together: 640M <em>(0.581s </em>0.125GB) = 46,480,000 GB-seconds of memory use. Since each one of these costs $0.000016, we can multiply those two as well: 46.48M GB-s * $0.000016 = $<strong>743.68</strong>. As you can see, this is about 85% of the now total cost of $873.68. This is obviously not cost effective, since the performance compares well to the 4x S1 app service at that velocity, costing $292.80/mo (and actually performs better).</p><h3>Updating the numbers</h3><p>Later on James <a href="https://www.azurefromthetrenches.com/azure-functions-significant-improvements-in-http-trigger-scaling/">updates his Azure Function performance numbers</a>, so we should update too. Taking the Stock Functions section, we can see that the performance of Azure Functions has significantly improved. Instead of a response time of 589ms, we now see it shoot all the way down to 69.5ms. (The throughput also improves, but I am going to keep the execution count the same to match the other app service data set). Since Azure rounds up to 100ms minimum, so will we. 640M <em>(0.1s </em>0.125GB) = 8,000,000 GB-seconds of memory use * $0.000016 = $128 - a <strong>MASSIVE</strong> savings. This now represents a little less than half of the cost of $258. This is also much more comparable to the $292 (and the added performance covers the $32 nicely - 11-14% in both cases).</p><h3>What does this mean?</h3><p>It means, that with the vastly improved performance of consumption functions, the cost difference between them and the standard app service plans is not significant (anymore, because it was massive previously).</p><p>If you have an unpredictable use pattern, don't be afraid to use consumption functions, as they are likely the better choice, even at large scale.</p><p>If you have a predictable dataset, and can get away with Basic App Service plans, you likely will save money doing so, so long as the aggregate monthly execution count is > 160M or so (the 640M / the 4 instances).</p><p>If you have need of an <em>individual</em> function running more swiftly, app service plans are your only means of doing so.</p><p>Hope this helps you reach a conclusion on how to build your functions!</p></div></div></div><footer><div class="mt-5 jumbotron jumbotron-fluid"><div class="container"><p class="text-muted">This site was built using <a href="https://www.typescriptlang.org/">Create React App</a>, with <a href="https://github.com/stereobooster/react-snap">TypeScript</a> to make it scalable (for no reason), <a href="https://react-bootstrap.github.io/">React-Snap</a> to make it static and performant, <a href="https://jekyllrb.com/">React Helmet</a> for SEO, and <a href="/r">React Bootstrap</a> to skin it. It's hosted on GitHub Pages, feel free to have a look at the <a href="https://github.com/dkershner6/dkershner6.github.io/tree/master/devenvironment">open source code</a>. This site is used for testing and changes very frequently, and items are often broken. In the past, it has been built with <a href="https://www.gatsbyjs.org/">GatsbyJS</a>, <a href="https://jekyllrb.com/">Jekyll</a>, WordPress, PHP, and Raw HTML<a href="/r">.</a></p></div></div></footer></div><script src="https://www.google-analytics.com/analytics.js" async></script><script src="https://www.google-analytics.com/analytics.js" async></script><script>!function(l){function e(e){for(var r,t,n=e[0],o=e[1],u=e[2],f=0,i=[];f<n.length;f++)t=n[f],p[t]&&i.push(p[t][0]),p[t]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(l[r]=o[r]);for(s&&s(e);i.length;)i.shift()();return c.push.apply(c,u||[]),a()}function a(){for(var e,r=0;r<c.length;r++){for(var t=c[r],n=!0,o=1;o<t.length;o++){var u=t[o];0!==p[u]&&(n=!1)}n&&(c.splice(r--,1),e=f(f.s=t[0]))}return e}var t={},p={1:0},c=[];function f(e){if(t[e])return t[e].exports;var r=t[e]={i:e,l:!1,exports:{}};return l[e].call(r.exports,r,r.exports,f),r.l=!0,r.exports}f.m=l,f.c=t,f.d=function(e,r,t){f.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},f.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.t=function(r,e){if(1&e&&(r=f(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(f.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var n in r)f.d(t,n,function(e){return r[e]}.bind(null,n));return t},f.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(r,"a",r),r},f.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},f.p="/";var r=window.webpackJsonp=window.webpackJsonp||[],n=r.push.bind(r);r.push=e,r=r.slice();for(var o=0;o<r.length;o++)e(r[o]);var s=n;a()}([])</script><script src="/static/js/2.9796f5c4.chunk.js"></script><script src="/static/js/main.617d17a6.chunk.js"></script></body></html>