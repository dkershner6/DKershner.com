<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link href="/favicon.ico" rel="shortcut icon"><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport"><meta content="#000000" name="theme-color"><link href="/manifest.json" rel="manifest"><title>Azure Functions: Serilog Gotchas | DKershner.com</title><link href="/static/css/main.4993c736.chunk.css" rel="stylesheet"><link href="https://fonts.googleapis.com" rel="preconnect"><style data-styled="" data-styled-version="4.3.2"></style><link href="https://www.google-analytics.com" rel="preconnect"><link href="https://fonts.gstatic.com" rel="preconnect"><link href="/static/js/2.ee755d40.chunk.js" rel="preload" as="script"><link href="/static/js/main.1a49cb78.chunk.js" rel="preload" as="script"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><nav class="navbar navbar-expand-lg navbar-dark bg-dark"><a href="/" class="active navbar-brand">Derek Kershner</a><button aria-controls="responsive-navbar-nav" aria-label="Toggle navigation" class="navbar-toggler" id="navbar-toggle" type="button"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="navbar-collapse"><div class="mr-auto navbar-nav"><a href="/" class="nav-link" data-rb-event-key="/">Home</a><a href="/#about" class="nav-link" data-rb-event-key="/#about">About</a><div class="dropdown nav-item" href="/portfolio"><a href="#" class="dropdown-toggle nav-link" aria-expanded="false" aria-haspopup="true" role="button">Portfolio</a><div class="dropdown-menu" aria-labelledby=""><a href="/portfolio/enterpriseMarketplace" class="dropdown-item">Enterprise Marketplace</a><a href="/portfolio/shopifySearchEngine" class="dropdown-item">Shopify Search Engine</a></div></div><a href="/blog" class="nav-link" data-rb-event-key="/blog">Blog</a></div></div></nav><div class="bg-primary text-light jumbotron jumbotron-fluid"><div class="container"><h1>Azure Functions: Serilog Gotchas</h1><h5>Serilog appears easy to use in Azure Functions, but apperances can be deceiving</h5><h6>2019-07-01 by Derek Kershner</h6></div></div><div class="mt-5 container"><div class="row"><div class="col"><h3>Some Background</h3><p>Azure Functions have great struggles when it comes to clients not being created statically. They note this in their docs very well, but on occasion you can do this in unknown fashion. The result, when it occurs, is very high connection or thread counts, which can lead to shutdowns as you approach <a href="/blog/azure-functions-limits-how-to-overcome">the limits</a>.</p><h3>Enter Serilog</h3><p>Serilog is very convenient, and one of the easiest ways to implement custom logging in Azure Functions. The recommended approaches to instantiate Serilog are typically:</p><ul><li>A global static variable - If you do this, you cannot use Azure Function's ILogger, and if you instantiate one per function, you will also hit limits.</li><li>A (using) wrapper - If you do this, you will hit limits eventually (it takes a lot of concurrency).</li></ul><p><a href="https://evandontje.com/2018/10/09/high-thread-count-in-azure-functions/">Evan Dontje encountered the the first bullet point</a>, and you can read about his experience there. I thought I was being savvy by doing it in a using clause, but after weeks of talks with Azure Support, I found out that I was just as bad off as he was.</p><h3>Solution</h3><p>In order to solve this issue, I used a combination of the two strategies, with a null check.</p><p>Above the function:</p><pre><code class="language-csharp">private static Logger Log = null;</code></pre><p>Inside the function:</p><pre><code class="language-csharp">if (Log == null)
{
  Log = CreateYourLoggerHere.Create();
}</code></pre><p>Simple, a little hacky, but it works. Don't spend the same time with Azure Support like I did.</p></div></div></div><footer><div class="mt-5 jumbotron jumbotron-fluid"><div class="container"><p class="text-muted">This site was built using <a href="https://github.com/facebook/create-react-app">Create React App</a>, with <a href="https://www.typescriptlang.org/">TypeScript</a> to make it scalable (for no reason), <a href="https://github.com/stereobooster/react-snap">React-Snap</a> to make it static and performant, <a href="https://github.com/nfl/react-helmet">React Helmet</a> for SEO, and <a href="https://react-bootstrap.github.io/">React Bootstrap</a> to skin it. It's hosted on GitHub Pages, feel free to have a look at the <a href="https://github.com/dkershner6/dkershner6.github.io/tree/master/devenvironment">open source code</a>. This site is used for testing and changes very frequently, and items are often broken. In the past, it has been built with <a href="https://www.gatsbyjs.org/">GatsbyJS</a>, <a href="https://jekyllrb.com/">Jekyll</a>, WordPress, PHP, and Raw HTML<a href="/r">.</a></p></div></div></footer></div><script src="https://www.google-analytics.com/analytics.js" async></script><script>!function(l){function e(e){for(var r,t,n=e[0],o=e[1],u=e[2],f=0,i=[];f<n.length;f++)t=n[f],p[t]&&i.push(p[t][0]),p[t]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(l[r]=o[r]);for(s&&s(e);i.length;)i.shift()();return c.push.apply(c,u||[]),a()}function a(){for(var e,r=0;r<c.length;r++){for(var t=c[r],n=!0,o=1;o<t.length;o++){var u=t[o];0!==p[u]&&(n=!1)}n&&(c.splice(r--,1),e=f(f.s=t[0]))}return e}var t={},p={1:0},c=[];function f(e){if(t[e])return t[e].exports;var r=t[e]={i:e,l:!1,exports:{}};return l[e].call(r.exports,r,r.exports,f),r.l=!0,r.exports}f.m=l,f.c=t,f.d=function(e,r,t){f.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},f.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.t=function(r,e){if(1&e&&(r=f(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(f.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var n in r)f.d(t,n,function(e){return r[e]}.bind(null,n));return t},f.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(r,"a",r),r},f.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},f.p="/";var r=window.webpackJsonp=window.webpackJsonp||[],n=r.push.bind(r);r.push=e,r=r.slice();for(var o=0;o<r.length;o++)e(r[o]);var s=n;a()}([])</script><script src="/static/js/2.ee755d40.chunk.js"></script><script src="/static/js/main.1a49cb78.chunk.js"></script></body></html>