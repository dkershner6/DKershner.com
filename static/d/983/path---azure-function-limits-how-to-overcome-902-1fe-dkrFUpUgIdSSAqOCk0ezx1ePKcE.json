{"data":{"post":{"id":"c7574981-17e0-5607-9eb6-04e85b87f4e2","html":"<h3>Limits? In serverless?</h3>\n<p>If you travel to pages like the <a href=\"https://docs.microsoft.com/en-us/azure/azure-functions/functions-scale#understanding-scaling-behaviors\">scale and hosting</a>, you may, rightly, be under the impression that azure functions can scale pretty massively.  (At time of writing) 200 instances?  Multi-messages per instance? I can do 1000 things at once!</p>\n<p>While this is technically true, you better be doing 1000 Hello Worldâ€™s, because Azure Functions running on the consumption model reside in the <a href=\"https://github.com/projectkudu/kudu/wiki/Azure-Web-App-sandbox#per-sandbox-per-appper-site-numerical-limits\">Azure Sandbox</a>.  You will note that the documentation here is much more hidden, but there are some <a href=\"https://www.troyhunt.com/breaking-azure-functions-with-too-many-connections/\">other bloggers</a> who have hit limits as well. The Azure Sandbox is where Free and Shared App Services run, and also consumption functions. Because of this grouping, the limits are smaller than you might think when reading Azure marketing jargon. This is not an Azure-specific issue, as AWS has similar limits (although a bit easier to find).</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/27bdb4a9cb306c53353570350f433baa/05d04/limitstable.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 738px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 67.07317073170731%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAQAF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3USmP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEAAQUCX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABgQAAMBAQAAAAAAAAAAAAAAAAEQEQAh/9oACAEBAAE/IeIGhzf/2gAMAwEAAgADAAAAEBMP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFRgf/aAAgBAQABPxChOcc+wrJWDfsDHYAMn//Z'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;\"\n        alt=\"Limits Table\"\n        title=\"\"\n        src=\"/static/27bdb4a9cb306c53353570350f433baa/05d04/limitstable.jpg\"\n        srcset=\"/static/27bdb4a9cb306c53353570350f433baa/f03e8/limitstable.jpg 200w,\n/static/27bdb4a9cb306c53353570350f433baa/0532f/limitstable.jpg 400w,\n/static/27bdb4a9cb306c53353570350f433baa/05d04/limitstable.jpg 738w\"\n        sizes=\"(max-width: 738px) 100vw, 738px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>There are 5 limits, but really only 2 to worry about, as you are likely to hit them before others: Connections and Threads. The connections limit is in the process of being lifted to 600, and all of my apps appear to be operating with the higher limit, but you may still be experiencing the lower limit at time of writing. Before the connection limit change, I never hit the thread limit. After the change, I have never hit the connection limit, only threads.</p>\n<h3>How to Overcome</h3>\n<h4>Connection-Specific</h4>\n<ol>\n<li>\n<p>There are some general design principles to follow when writing in C# that may not be altogether obvious from the way the interfaces are written. <a href=\"https://docs.microsoft.com/en-us/azure/azure-functions/manage-connections\">Azure documentation itself</a> actually has some great guidance here, and they go into lots of detail, but I will quickly touch on here:</p>\n</li>\n<li>\n<p>Static Clients: Create one static HttpClient (and Azure Storage Clients) on instance-load and use it for every call. This is not totally obvious, given the fact that HttpClient is disposable, so it is tempting to use it in a using statement. <a href=\"https://docs.microsoft.com/en-us/azure/architecture/antipatterns/improper-instantiation/\">DO NOT DO THIS</a>.</p>\n</li>\n<li>\n<p>Pooled connections for Sql/Entity Framework: This is commonplace in the connection string, and is the default functionality, so it is much less common to run into issues.</p>\n</li>\n</ol>","fields":{"slug":"/azure-function-limits-how-to-overcome/","prefix":"2019-02-27"},"frontmatter":{"title":"Consumption Azure Functions Limits & How to Overcome them","author":"Derek Kershner","category":"Azure Functions","cover":{"childImageSharp":{"resize":{"src":"/static/a811f5af8e19b59d1b86e9d4f5231b97/c8002/gate.jpg"}}}}},"authornote":{"id":"3025ae0b-46e9-5881-aee4-12170e6ddfae","html":"<p><strong>Derek Kershner</strong> Coming from being a Data Analyst, and becoming a .NET Developer, Kubernetes Architect, and Azure Cloud Consultant, a unique perspective is born, and this is him writing about what he figures out along the way.</p>"},"site":{"siteMetadata":{"facebook":{"appId":""}}}},"pageContext":{"slug":"/azure-function-limits-how-to-overcome/","prev":{"id":"bb09f7f9-e183-5e6d-89b5-0a67d417a1cc","fields":{"slug":"/azure-functions-consumption-vs-app-service-vs-kubernetes/","prefix":"2019-02-26","source":"posts"},"frontmatter":{"title":"Azure Functions v2 Consumption vs App Service Plan vs Kubernetes - Where to Host for optimal cost and performance?","category":"Azure Functions"}},"source":"posts"}}