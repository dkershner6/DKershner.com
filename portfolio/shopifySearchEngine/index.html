<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><link href="/favicon.ico" rel="shortcut icon"><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport"><meta content="#000000" name="theme-color"><link href="/manifest.json" rel="manifest"><title>Portfolio - Shopify Search Engine | DKershner.com</title><link href="/static/css/main.2748c3d7.chunk.css" rel="stylesheet"><link href="https://fonts.googleapis.com" rel="preconnect"><style data-styled="" data-styled-version="4.2.0">.eNtBPp{position:relative;min-height:90vh}.euJmIX{position:absolute;top:0;right:0;bottom:0;left:0;background-attachment:fixed;background-image:url(/images/helicopter.jpg);background-position:center center;background-repeat:no-repeat;background-size:cover;opacity:0;transition-duration:.6s;transition-property:opacity;transition-timing-function:ease-in-out}.bUBUSx{position:absolute;top:0;right:0;bottom:0;left:0;background-attachment:fixed;background-image:url(/images/helicopter.jpg);background-position:center center;background-repeat:no-repeat;background-size:cover;opacity:1;transition-duration:.6s;transition-property:opacity;transition-timing-function:ease-in-out}.tlMmT{position:absolute;top:0;right:0;bottom:0;left:0;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;text-align:center;background-color:rgba(17,0,0,.6)}</style><link href="https://www.google-analytics.com" rel="preconnect"><link href="https://fonts.gstatic.com" rel="preconnect"><link href="/static/js/2.e726ecf7.chunk.js" rel="preload" as="script"><link href="/static/js/main.acbfc2f8.chunk.js" rel="preload" as="script"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><nav class="navbar navbar-expand-lg navbar-dark bg-dark"><a href="/" class="active navbar-brand">DKershner.com</a><button aria-controls="responsive-navbar-nav" aria-label="Toggle navigation" class="navbar-toggler" id="navbar-toggle" type="button"><span class="navbar-toggler-icon"></span></button><div class="navbar-collapse collapse" id="navbar-collapse"><div class="mr-auto navbar-nav"><a href="/" class="nav-link" data-rb-event-key="/">Home</a><a href="/#about" class="nav-link" data-rb-event-key="/#about">About</a><div class="dropdown nav-item" href="/portfolio"><a href="#" class="dropdown-toggle nav-link" aria-expanded="false" aria-haspopup="true" role="button">Portfolio</a><div class="dropdown-menu" aria-labelledby=""><a href="/portfolio/enterpriseMarketplace" class="dropdown-item">Enterprise Marketplace</a><a href="/portfolio/shopifySearchEngine" class="dropdown-item">Shopify Search Engine</a></div></div><a href="/blog" class="nav-link" data-rb-event-key="/blog">Blog</a></div></div></nav><div class="sc-bwzfXH eNtBPp"><div class="sc-bdVaJa sc-htpNat bUBUSx" style="background-position-y:50%"></div><div class="sc-bdVaJa sc-bxivhb tlMmT" color="#110000" opacity="0.6"><div><h1 class="display-3 text-center text-white">Shopify Search Engine</h1><div class="container"><div class="justify-content-center row"><div class="text-left text-white col-xl-9"><h4>Project Specification</h4><ul><li>Fast. Shopify's default search was not meeting performance expectations.</li><li>Synonyms of searched words.</li><li>Redirection of certain terms to various site pages.</li><li>Custom fields used in searching and more page types returned than Shopify's default.</li><li>Custom weighting of fields and "Boosting" of certain result sets based on criteria.</li></ul></div></div><div class="justify-content-center mt-5 row"><div class="text-center col"><a href="#design" class="btn btn-danger"><svg preserveAspectRatio="xMidYMid meet" style="width:50px;height:50px" viewBox="-25 -25 50 50"><defs><clipPath id="react-arrow-stroke-clip-0"><path d="M-12.5,-25
L-12.5,0
L-25,0
L0,25
L25,0
L12.5,0
L12.5,-25 z"></path></clipPath></defs><path d="M-12.5,-25
L-12.5,0
L-25,0
L0,25
L25,0
L12.5,0
L12.5,-25 z" clip-path="url(#react-arrow-stroke-clip-0)" direction="down" fill="white" stroke="white" stroke-width="2"></path></svg></a></div></div></div></div></div></div><div class="mt-5 container"><div class="mt-3 row"><div class="col"><div class="card bg-info"><div class="card-header"><h2 class="text-light" id="design">General Application Design Principles</h2></div><div class="list-group"><div class="list-group-item">Microservices...to a point. Never a monolith, but let scale justify a new application service. I don't necessarily agree with <a href="https://buttercms.com/books/microservices-for-startups/should-you-always-start-with-a-monolith">the argument that monoliths should be the initial design for startup apps</a>, but understand the reasons and err in that direction.</div><div class="list-group-item">Data is generally grouped for the entire app in a single instance for compute cost efficiency.</div><div class="list-group-item">Use technologies that minimize ongoing maintenance of the application. This generally means heavy use of serverless technologies. The reasoning behind this is that maintenance typically exceeds development in terms of cost and time, so the additional costs for not managing infrastructure are justfied at small to medium scale.</div><div class="list-group-item">Some cloud-specific technologies are used, but generally cloud-agnostic technologies are preferred. This generally means heavy use of containers.</div><div class="list-group-item">Continuous Integration & Deployment is used in all cases, but will not be listed as such. In nearly all cases, the flow is from GitHub to Azure DevOps/VSTS to the deployment target.</div></div></div></div></div><div class="mt-4 text-center row"><div class="col"><h2>Application Design</h2></div></div><div class="text-center row"><div class="col"><p class="text-muted">Click headers to expand/collapse</p></div></div><div class="mt-3 row"><div class="col"><div class="card bg-danger text-light"><div class="card-header" style="cursor:pointer"><h3>Data</h3></div><div class="collapse card-body"><div class="row"><div class="mt-3 col-xl-6 col-12"><div class="card bg-secondary text-dark"><div class="card-header" style="cursor:pointer"><h4>Persistence</h4></div><div class="collapse list-group"><a href="https://azure.microsoft.com/en-us/services/storage/blobs/" class="list-group-item list-group-item-action" data-rb-event-key="https://azure.microsoft.com/en-us/services/storage/blobs/" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Technology:</strong></div><div class="col-md-9 col-12">Azure Blob / Table Storage</div></div></a><div class="list-group-item" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Function:</strong></div><div class="col-md-9 col-12">House the data to be indexed as well as other app data</div></div></div></div><div class="collapse card-footer"><div class="row"><div class="col"><p><strong>Reasons:</strong></p><ul><li>Data Model is fairly well-defined, but there are nested properties and arrays, and no relationships involved that make an RDBMS less ideal. The data model is also very simple (1 collection). Azure Blob Storage is an extremely simple form of storage, basically just files with some special consideration for text files. In this case, it was used with Serialized JSON, creating essentially the world's simplest document database with only one index/lookup.</li><li>The data is VERY high touch, the indexing process is a very large amount of checking and re-checking. Azure Blob Storage is both very high performing (20,000 requests/second at time of writing) and very cheap ($0.023 per million requests at time of writing).</li><li>Our initial choice was actually SQL Server, but the amount of compute needed to handle the request load was high. Blob Storage was about 1/20th the cost for the same request load.</li></ul></div></div></div></div></div><div class="mt-3 col-xl-6 col-12"><div class="card bg-secondary text-dark"><div class="card-header" style="cursor:pointer"><h4>Search Engine</h4></div><div class="collapse list-group"><a href="https://azure.microsoft.com/en-us/services/search/" class="list-group-item list-group-item-action" data-rb-event-key="https://azure.microsoft.com/en-us/services/search/" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Technology:</strong></div><div class="col-md-9 col-12">Azure Search</div></div></a><div class="list-group-item" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Function:</strong></div><div class="col-md-9 col-12">Properly index the site data for rapid searching</div></div></div></div><div class="collapse card-footer"><div class="row"><div class="col"><p><strong>Reasons:</strong></p><ul><li>Azure Search is a search as a service built on top of ElasticSearch, which is highly regarded in the search arena. Azure adds a few nice features from SOLR over the top of it to make it a very compelling offer.</li><li>Azure Search comes at a fairly steep minimum level, but the vastly decreased development time deriving from not having to develop an indexer (it can automatically index blob storage) and not needing to code for synonyms (it has this feature) made it well worth it.</li></ul></div></div></div></div></div><div class="mt-3 col-xl-6 col-12"><div class="card bg-secondary text-dark"><div class="card-header" style="cursor:pointer"><h4>Cache</h4></div><div class="collapse list-group"><a href="https://redis.io/" class="list-group-item list-group-item-action" data-rb-event-key="https://redis.io/" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Technology:</strong></div><div class="col-md-9 col-12">Redis</div></div></a><a href="https://kubernetes.io" class="list-group-item list-group-item-action" data-rb-event-key="https://kubernetes.io" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Deployment:</strong></div><div class="col-md-9 col-12">Docker/Kubernetes</div></div></a><div class="list-group-item" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Function:</strong></div><div class="col-md-9 col-12">A cache to house frequently requested data to improve performance</div></div></div></div><div class="collapse card-footer"><div class="row"><div class="col"><p><strong>Reasons:</strong></p><ul><li>A cache was critical to improving performance in the front end by returning frequently requested data in milliseconds.</li><li>Redis is the industry standard, and .NET has a beautiful library from StackExchange for using it. These factors made the decision clear.</li><li>I decided to host our own instances of Redis rather than use something like Azure Redis Cache. The cost increase was too great to justify a very small convenience gain.</li></ul></div></div></div></div></div><div class="mt-3 col-xl-6 col-12"><div class="card bg-secondary text-dark"><div class="card-header" style="cursor:pointer"><h4>Non-Persisted</h4></div><div class="collapse list-group"><a href="https://azure.microsoft.com/" class="list-group-item list-group-item-action" data-rb-event-key="https://azure.microsoft.com/" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Monitoring:</strong></div><div class="col-md-9 col-12">Azure Monitor, Log Analytics, Application Insights</div></div></a><a href="https://azure.microsoft.com/" class="list-group-item list-group-item-action" data-rb-event-key="https://azure.microsoft.com/" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Queue Messaging:</strong></div><div class="col-md-9 col-12">Azure Storage Queues</div></div></a></div></div></div></div></div></div></div></div><div class="mt-3 text-center row"><div class="col"><svg preserveAspectRatio="xMidYMid meet" style="width:50px;height:50px" viewBox="-25 -25 50 50"><defs><clipPath id="react-arrow-stroke-clip-1"><path d="M-12.5,-25
L-12.5,0
L-25,0
L0,25
L25,0
L12.5,0
L12.5,-25 z"></path></clipPath></defs><path d="M-12.5,-25
L-12.5,0
L-25,0
L0,25
L25,0
L12.5,0
L12.5,-25 z" clip-path="url(#react-arrow-stroke-clip-1)" direction="down" fill="#110000" stroke="#110000" stroke-width="2"></path></svg></div></div><div class="mt-3 row"><div class="col"><div class="card bg-warning text-light"><div class="card-header" style="cursor:pointer"><h3>Back-End</h3></div><div class="collapse card-body"><div class="row"><div class="mt-3 col-xl-6 col-12"><div class="card bg-secondary text-dark"><div class="card-header" style="cursor:pointer"><h4>API</h4></div><div class="collapse list-group"><a href="https://dotnet.microsoft.com/apps/aspnet" class="list-group-item list-group-item-action" data-rb-event-key="https://dotnet.microsoft.com/apps/aspnet" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Technology:</strong></div><div class="col-md-9 col-12">ASP.Net Core</div></div></a><a href="https://kubernetes.io" class="list-group-item list-group-item-action" data-rb-event-key="https://kubernetes.io" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Deployment:</strong></div><div class="col-md-9 col-12">Docker/Kubernetes</div></div></a><div class="list-group-item" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Function:</strong></div><div class="col-md-9 col-12">Provide data to the Shopify Admin UI, allowing modification for logged in store owners</div></div></div></div><div class="collapse card-footer"><div class="row"><div class="col"><p><strong>Reasons:</strong></p><ul><li>ASP.Net Core can be deployed anywhere, provides lots of boilerplate in terms of API creation, and is generally a very productive way to code by using dependency injection where possible.</li><li>Entity Framework Core was not used in this case, as Azure Storage is not supported by it (nor should it be).</li><li>This API also provides a wrapper for the Azure Search index API, allowing requests to be simpler from any front end, and can handle the caching behavior to speed things up.</li><li>This also implements the page redirection for certain terms.</li></ul></div></div></div></div></div><div class="mt-3 col-xl-6 col-12"><div class="card bg-secondary text-dark"><div class="card-header" style="cursor:pointer"><h4>Change Detector</h4></div><div class="collapse list-group"><a href="https://azure.microsoft.com/en-us/services/functions/" class="list-group-item list-group-item-action" data-rb-event-key="https://azure.microsoft.com/en-us/services/functions/" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Technology:</strong></div><div class="col-md-9 col-12">Azure Functions</div></div></a><a href="https://kubernetes.io" class="list-group-item list-group-item-action" data-rb-event-key="https://kubernetes.io" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Deployment:</strong></div><div class="col-md-9 col-12">Docker/Kubernetes</div></div></a><div class="list-group-item" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Function:</strong></div><div class="col-md-9 col-12">Through a combination of webhooks and polling, detect changes in the front end and hand them off to a queue</div></div></div></div><div class="collapse card-footer"><div class="row"><div class="col"><p><strong>Reasons:</strong></p><ul><li>Azure Functions provides an easy to use code base for scheduled jobs (especially) and has nearly unlimited flexibility in terms of deployment and even language choice (this is like Lambdas for the AWS folks in the crowd, but can be deployed in containers).</li><li>A queue (and separate service) was used to actually index the data to combat the need for 100% uptime.</li></ul></div></div></div></div></div><div class="mt-3 col-xl-6 col-12"><div class="card bg-secondary text-dark"><div class="card-header" style="cursor:pointer"><h4>Indexer</h4></div><div class="collapse list-group"><a href="https://azure.microsoft.com/en-us/services/functions/" class="list-group-item list-group-item-action" data-rb-event-key="https://azure.microsoft.com/en-us/services/functions/" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Technology:</strong></div><div class="col-md-9 col-12">Azure Functions</div></div></a><a href="https://kubernetes.io" class="list-group-item list-group-item-action" data-rb-event-key="https://kubernetes.io" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Deployment:</strong></div><div class="col-md-9 col-12">Docker/Kubernetes</div></div></a><div class="list-group-item" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Function:</strong></div><div class="col-md-9 col-12">As a queue fills, make changes to the index according to the messages</div></div></div></div><div class="collapse card-footer"><div class="row"><div class="col"><p><strong>Reasons:</strong></p><ul><li>Azure Functions provides automatic integration with queues, enabling easy and quick development for this service.</li></ul></div></div></div></div></div></div></div></div></div></div><div class="mt-3 text-center row"><div class="col"><svg preserveAspectRatio="xMidYMid meet" style="width:50px;height:50px" viewBox="-25 -25 50 50"><defs><clipPath id="react-arrow-stroke-clip-2"><path d="M-12.5,-25
L-12.5,0
L-25,0
L0,25
L25,0
L12.5,0
L12.5,-25 z"></path></clipPath></defs><path d="M-12.5,-25
L-12.5,0
L-25,0
L0,25
L25,0
L12.5,0
L12.5,-25 z" clip-path="url(#react-arrow-stroke-clip-2)" direction="down" fill="#110000" stroke="#110000" stroke-width="2"></path></svg></div></div><div class="mt-3 row"><div class="col"><div class="card bg-success text-light"><div class="card-header" style="cursor:pointer"><h3>Front-End</h3></div><div class="collapse card-body"><div class="row"><div class="mt-3 col-xl-6 col-12"><div class="card bg-secondary text-dark"><div class="card-header" style="cursor:pointer"><h4>Shopify Admin UI</h4></div><div class="collapse list-group"><a href="https://reactjs.org/" class="list-group-item list-group-item-action" data-rb-event-key="https://reactjs.org/" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Technology:</strong></div><div class="col-md-9 col-12">React</div></div></a><a href="https://www.typescriptlang.org/" class="list-group-item list-group-item-action" data-rb-event-key="https://www.typescriptlang.org/" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Sub-Technology:</strong></div><div class="col-md-9 col-12">TypeScript</div></div></a><a href="https://kubernetes.io" class="list-group-item list-group-item-action" data-rb-event-key="https://kubernetes.io" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Deployment:</strong></div><div class="col-md-9 col-12">Docker/Kubernetes</div></div></a><div class="list-group-item" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Function:</strong></div><div class="col-md-9 col-12">Provide an Admin UI to store owners to make changes to how the search engine works</div></div></div></div><div class="collapse card-footer"><div class="row"><div class="col"><p><strong>Reasons:</strong></p><ul><li>React is the only framework allowed by Shopify for the admin pages for its apps.</li><li>TypeScript provides type safety for decreasing bugs in Javascript and generally makes the code more organized and easier to understand. This is great for other developers (and therefore scaling).</li></ul></div></div></div></div></div><div class="mt-3 col-xl-6 col-12"><div class="card bg-secondary text-dark"><div class="card-header" style="cursor:pointer"><h4>Shopify Application Proxy</h4></div><div class="collapse list-group"><a href="https://reactjs.org/" class="list-group-item list-group-item-action" data-rb-event-key="https://reactjs.org/" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Technology:</strong></div><div class="col-md-9 col-12">React</div></div></a><a href="https://dotnet.microsoft.com/apps/aspnet" class="list-group-item list-group-item-action" data-rb-event-key="https://dotnet.microsoft.com/apps/aspnet" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Sub-Technology:</strong></div><div class="col-md-9 col-12">ASP.Net Core</div></div></a><a href="https://kubernetes.io" class="list-group-item list-group-item-action" data-rb-event-key="https://kubernetes.io" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Deployment:</strong></div><div class="col-md-9 col-12">Docker/Kubernetes</div></div></a><a href="https://www.babyearth.com/apps/search/?query=test" class="list-group-item list-group-item-action" data-rb-event-key="https://www.babyearth.com/apps/search/?query=test" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Example:</strong></div><div class="col-md-9 col-12">Babyearth.com</div></div></a><div class="list-group-item" target="_blank"><div class="row"><div class="col-md-3 col-12"><strong>Function:</strong></div><div class="col-md-9 col-12">Provide the actual app that customers use to search the website, served through a proxy</div></div></div></div><div class="collapse card-footer"><div class="row"><div class="col"><p><strong>Reasons:</strong></p><ul><li>It may seem odd to list ASP.NET Core as a front end technology, but in this case it was only used for its Razor frontend markup and to control some attributes of the response. Shopify has some specific requirements with how this response needs to look, and ASP.NET trivialized this task.</li><li>What the customer actually sees and interacts with is React. We chose to go a javascript route (rather than pure Razor) in order to make the initial page render quicker (even if it is just a loader) and because it made tracking all of the search engine filters on the front end very simple.</li><li>Since this is an actual public front end, you can use the example link above to see it.</li></ul></div></div></div></div></div></div></div></div></div></div></div><footer><div class="mt-5 jumbotron jumbotron-fluid"><div class="container"><p class="text-muted">This site was built using <a href="https://github.com/facebook/create-react-app">Create React App</a>, with <a href="https://www.typescriptlang.org/">TypeScript</a> to make it scalable (for no reason), <a href="https://github.com/stereobooster/react-snap">React-Snap</a> to make it static and performant, <a href="https://github.com/nfl/react-helmet">React Helmet</a> for SEO, and <a href="https://react-bootstrap.github.io/">React Bootstrap</a> to skin it. It's hosted on GitHub Pages, feel free to have a look at the <a href="https://github.com/dkershner6/dkershner6.github.io/tree/master/devenvironment">open source code</a>. This site is used for testing and changes very frequently, and items are often broken. In the past, it has been built with <a href="https://www.gatsbyjs.org/">GatsbyJS</a>, <a href="https://jekyllrb.com/">Jekyll</a>, WordPress, PHP, and Raw HTML<a href="/r">.</a></p></div></div></footer></div><script src="https://www.google-analytics.com/analytics.js" async></script><script>!function(l){function e(e){for(var r,t,n=e[0],o=e[1],u=e[2],f=0,i=[];f<n.length;f++)t=n[f],p[t]&&i.push(p[t][0]),p[t]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(l[r]=o[r]);for(s&&s(e);i.length;)i.shift()();return c.push.apply(c,u||[]),a()}function a(){for(var e,r=0;r<c.length;r++){for(var t=c[r],n=!0,o=1;o<t.length;o++){var u=t[o];0!==p[u]&&(n=!1)}n&&(c.splice(r--,1),e=f(f.s=t[0]))}return e}var t={},p={1:0},c=[];function f(e){if(t[e])return t[e].exports;var r=t[e]={i:e,l:!1,exports:{}};return l[e].call(r.exports,r,r.exports,f),r.l=!0,r.exports}f.m=l,f.c=t,f.d=function(e,r,t){f.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},f.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.t=function(r,e){if(1&e&&(r=f(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var t=Object.create(null);if(f.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var n in r)f.d(t,n,function(e){return r[e]}.bind(null,n));return t},f.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(r,"a",r),r},f.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},f.p="/";var r=window.webpackJsonp=window.webpackJsonp||[],n=r.push.bind(r);r.push=e,r=r.slice();for(var o=0;o<r.length;o++)e(r[o]);var s=n;a()}([])</script><script src="/static/js/2.e726ecf7.chunk.js"></script><script src="/static/js/main.acbfc2f8.chunk.js"></script></body></html>